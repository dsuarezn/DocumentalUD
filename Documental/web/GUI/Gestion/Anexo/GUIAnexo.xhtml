<!--<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">-->
<ui:composition template="/WEB-INF/plantillas/menuDocumental.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">    
    <ui:define name="bodyJR">
        <p:panel id="cabezote">            
            <h:panelGrid columns="10" cellpadding="10">
                <h:outputText value="#{bundle.documental_GUIAnexo_TituloCabezote}" />                                       
            </h:panelGrid>  
        </p:panel>   
        <h:panelGroup id="messagePanel" layout="block">                            
            <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" ></p:messages> 
        </h:panelGroup>  
        <p:panelGrid style="margin-top:10px">
            <p:row>
                <p:column colspan="20" style="font-weight: bold;">
                    <h:outputText value="#{bundle.documental_GUIAnexo_formulario_documento}" />
                </p:column> 
                <p:column colspan="80" style="font-weight: bold;">
                    <h:outputText escape="false" value="#{beanAnexo.documentoSelecciondo.asunto}" />
                    <p:spacer width="10" height="10"/>
                    <h:outputText value="#{beanAnexo.documentoSelecciondo.descripcion}" />
                    <p:spacer width="10" height="10"/>
                    <h:outputText value="#{beanAnexo.documentoSelecciondo.fechaCreacion}">
                        <f:convertDateTime pattern="dd 'de' MMMM 'de' yyyy 'a las' hh:mm a" />
                    </h:outputText>
                    
                </p:column>
            </p:row>
            
        </p:panelGrid>           
        <p:panel footer="">
            <h:form id="agregarRegistro">
                <h:commandButton value="Agregar nuevo anexo" action="#{beanAnexo.agregarAnexo()}"  immediate="true">
                    <f:ajax execute="@form" render="frmListaAnexos:archivosAnexo" />
                </h:commandButton>                    
            </h:form>                        
            <h:form id="frmListaAnexos" enctype="multipart/form-data">                                        
                <p:dataTable id="archivosAnexo"  var="archivo" value="#{beanAnexo.items}"
                             emptyMessage="No Se Han Filtrado Resultados"                             
                             paginator="true" rows="15"                             
                             style="width: 100%"
                             paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,15"  
                             scrollable="true"
                             rowIndexVar="rowIndex"
                             >                                                          
                    <p:column headerText="Upload">                                                       
                            <p:fileUpload style="width:200px" fileUploadListener="#{archivo.manejarFileUpload}" mode="advanced"
                                          rendered="#{!archivo.persistido}" update="pArchivo"  auto="true" sizeLimit="5242880" allowTypes="/(\.|\/)(pdf)$/"  />                                                                                                                                
                    </p:column> 
                    <p:column id="pArchivo" headerText="Archivo">                                                       
                        <h:inputText  style="width:180px" id="nombreArchivo" value="#{archivo.nombreArchivo}" required="true" readonly="true"/>                        
                    </p:column> 
                    <p:column headerText="Comentario">                                                    
                        <h:inputTextarea id="comentario"  value="#{archivo.descripccion}" required="true" readonly="#{archivo.persistido == true and archivo.permitido}" >
                             <f:ajax execute="@form" render="RadicarFormulario:archivosAnexo" />
                        </h:inputTextarea>
                    </p:column>
                    <p:column headerText="Descarga">   
                        <h:commandButton  immediate="true" id="downloadButton" value="Descargar PDF" action="#{archivo.downloadFile}">                            
                        </h:commandButton>
                    </p:column>
                    <p:column headerText="Usuario">
                        <h:outputText value="#{archivo.nombreyApellido}" />
                    </p:column>   
                    <p:column headerText="Eliminar">
                        <h:commandButton rendered="#{archivo.persistido and archivo.permitido}"  id="bEliminar"  value="Eliminar" action="#{beanAnexo.deleteAction(archivo)}" >                                                        
                            <f:ajax execute="@form" render="frmListaAnexos:archivosAnexo" />
                        </h:commandButton>
                    </p:column>
                </p:dataTable> 
               
                <h:commandButton  value="Guardar Anexos" action="#{beanAnexo.create()}">
                    <f:ajax execute="@form" render="frmListaAnexos:archivosAnexo" />
                </h:commandButton>  
                <h:commandButton value="Volver" action="#{beanAnexo.volver()}" immediate="true"/>               
                
                <p:confirmDialog global="true" showEffect="fade" hideEffect="explode">
                    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                </p:confirmDialog>
               
            </h:form>               
        </p:panel>
    </ui:define>
</ui:composition>

